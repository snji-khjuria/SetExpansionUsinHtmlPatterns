(function(m,p,x){m.execute(function(){m.when("twister-variation-matrix","twister-dim-util","twister-state-machine","twister-metadata","twister-view-controller","twister-dispatcher","twister-actions","twister-slots-dimsum","twister-dimsum").register("TwisterCore",function(e,l,k,f,d,c,g,b,a){function n(g,h){this.tvm=new e(g);this.util=new l(this.tvm);this.tsm=new k(this.tvm,this.util,g.initDimCombination);this.dimSum=new a(g.config.ajaxTimeout,g.config.ajaxUrlParams,g.config.deviceType,h);this.slotsDimSum=
new b(g.config.ajaxTimeout,g.config.ajaxUrlParams,g.config.deviceType);var n=this;c.registerStore("twister-state-machine",function(a,b){n.tsm.accept(a,b).THEN(function(b){d.publishView(a,b)}).ELSE()});var m=new f;c.registerStore("twister-metadata",function(a,b){m.process(a,b,function(b){d.publishView(a,b)})})}function h(a,b){var d=a.viewAttribution+"_"+a.viewName+"_"+b;return function(a){try{var e=g.create(b,a);c.dispatch(b,e)}catch(f){p.ueLogError&&p.ueLogError(f,{logLevel:"ERROR",attribution:"Twister_view_"+
d,message:"This error is caused by the Twister view - "+d+" while updating the TwisterCore"})}}}n.prototype={registerActive:function(a,b){d.register(a.viewAttribution+"_"+a.viewName,b.updateView);return{dimensionChanged:h(a,"VARIATION_CHANGE"),dimensionPeek:h(a,"VARIATION_PEEK"),metaData:h(a,"METADATA")}},registerPassive:function(a,b){d.register(a.viewAttribution+"_"+a.viewName,b.updateView);return{metaData:h(a,"METADATA")}},state:function(){return this.tsm.currentState().selected().selectionInfo()}};
return n});m.when("A").register("twister-actions",function(e){var l=e.$,k={VARIATION_CHANGE:function(e){return e=l.isArray(e)?e:[e]},VARIATION_PEEK:function(e){return e},METADATA:function(e){return e}};return{create:function(e,d){return k[e]?k[e](d):!1}}});m.when("A","publisherSubscriber").register("twister-dispatcher",function(e,l){function k(){k=1;return this}var f=e.$,d=new l,k=0,c=[];return{registerStore:function(c,b){d.register(c,b);return this},deregisterStore:function(c){d.deRegister(c);
return this},dispatch:function(e,b){k?c.push(arguments):d.publish(e,b);return this},hold:k,release:function(){f.each(c,function(c,b){d.publish.apply(d,b)});k=0;return this}}});m.when("A","publisherSubscriber").register("twister-view-controller",function(e,l){function k(){d?c.push(arguments):(d=1,f.publish.apply(f,arguments),d=0,c.length&&k.apply(this,c.shift()));return this}var f=new l,d=0,c=[];return{register:function(c,b){f.register(c,b);return this},deRegister:function(c){f.deRegister(c);
return this},publishView:k}});m.when("A").register("twister-dimsel-api",function(e){function l(e){var d=this;this.dimSelectionMap={};this.selInfo=e;k.each(e,function(c,e){d.dimSelectionMap[e.dimKey]=e.val})}var k=e.$;l.prototype={matches:function(e){e=e.selectionInfo();for(var d=0;d<e.length;d++){var c=e[d].dimKey;if(!(c in this.dimSelectionMap)||this.dimSelectionMap[c]!==e[d].val)return!1}return!0},selectionInfo:function(){return e.copy(this.selInfo)}};return l});m.when("A",
"twister-dimsel-api").register("twister-dim-util",function(e,l){function k(d){this.tvm=d;this.dimensionMetaData={};var c=[];d=d.dimensionInfo;for(var e=0;e<d.length;e++){c.push(d[e].dimKey);var b={};b.isRequired=d[e].isRequired;b.isSingleton=d[e].isSingleton;b.dimOrder=e;b.size=d[e].size;this.dimensionMetaData[d[e].dimKey]=b}}var f=e.$;k.prototype={createSelectionInfo:function(d){return new l(d)},extendSelectionInfo:function(d,c,e){var b=e||0===e,a={},k=[];f.each(c.selectionInfo(),function(b,c){a[c.dimKey]=
c.val});f.each(d.selectionInfo(),function(c,d){var f=d.dimKey,l=b?e:d.val;f in a&&(l=a[f]);k.push({dimKey:f,val:l})});return new l(k)},createNextDimSelection:function(d,c){var e=[],b=c.selectionInfo(),a=this;f.each(d.split(":"),function(c,d){var f=b[c].dimKey,k=parseInt(d,10);a.dimensionMetaData[f].isRequired&&k!==b[c].val&&(k=-1);e.push({dimKey:f,val:k})});return new l(e)},getDimScore:function(d,c){var e=0,b=d.split(":"),a=this;f.each(c.selectionInfo(),function(c,d){var f=d.dimKey,k=d.val,l=parseInt(b[c],
10),m=b.length-c;k===l?(e+=200*m,a.dimensionMetaData[f].isRequired&&(e+=2E4)):(k=Math.abs(k-l),f=Math.round(k/a.dimensionMetaData[f].size*100),e+=100-f)});return e},isSingletonDim:function(d){return this.dimensionMetaData[d]?this.dimensionMetaData[d].isSingleton:!1},isRequiredDim:function(d){return this.dimensionMetaData[d]?this.dimensionMetaData[d].isRequired:!1},getDimensionInfo:function(){return this.tvm.dimensionInfo},getDimAvailability:function(d,c){c=c.selectionInfo?c:this.createSelectionInfo(c);
var e=[],b=[],a=this.tvm.dimensionList,k=this.tvm.dimtoValueMap[d],h=this.createSelectionInfo([{dimKey:d,val:-1}]),h=this.tvm.fetch(this.extendSelectionInfo(c,h).selectionInfo()),l={},m=this;f.each(h,function(b,c){l[c.split(":")[a.indexOf(d)]]=m.tvm.dimCombinations[c]});f.each(k,function(a,c){a in l?e.push({index:a,asin:l[a],label:c}):b.push({index:a,label:c})});return{available:e,unavailable:b}},getUnselectedDims:function(d){var c={};f.each(d,function(a,b){c[b.dimKey]=b.val});d=[];var e=this.tvm.dimensionList,
b;for(b in e)if(e.hasOwnProperty(b)){var a=e[b];if(c[a]===x||-1===c[a])this.isSingletonDim(a)?c[a]=0:d.push(a)}return d},showDimSum:function(d,c){var e=this.getUnselectedDims(c);return!e||0===e.length||1===e.length&&e[0]===d?1:0},isFullySelected:function(d){var c=!0;"string"===typeof d&&(d=this.getSelectionInfoFromDimComb(d));d=d.selectionInfo?d.selectionInfo():d;if(d.length!=this.tvm.dimensionList.length)return!1;f.each(d,function(d,b){-1===b.val&&(c=!1)});return c},createDimensionSelectionMap:function(d){var c=
{},e;for(e in d)if(d.hasOwnProperty(e)){var b=d[e];c[b.dimKey]=b.val}return c},getSelectedDimKeys:function(d){var c=this.tvm.dimensionList,e=[],b;for(b in c)if(c.hasOwnProperty(b)){var a=d[c[b]];"undefined"===typeof a||-1==a?e.push("*"):e.push(a)}return e},getValidDimCombination:function(d,c){var e,b,a=this,k=0,h=0;b=this.tvm.fetch(d);f.each(b,function(b,d){h=a.getDimScore(d,c);h>k&&(e=b,k=h)});return b[e]},getAsinFromSelectionInfo:function(d,c){var g,b;"undefined"==typeof c||c?g=this.createDimensionSelectionMap(d):
(b=e.copy(d),g=this.getValidDimCombination(b,this.createSelectionInfo(d)),f.each(g.split(":"),function(a,c){var d=parseInt(c,10);b[a].val=d}),g=this.createDimensionSelectionMap(b));g=this.getSelectedDimKeys(g).join(":");return this.tvm.dimCombinations[g]},getSelectionInfoFromSelectedVariationValuesMap:function(d){var c=[],e;for(e in this.tvm.dimensionList){var b={},a=this.tvm.dimensionList[e];b.dimKey=a;b.val=d[a];c.push(b)}return c},getSelectionInfoFromDimComb:function(d){var c=[];d=d.split("_");
for(var e in this.tvm.dimensionList){var b={},a=d[e];b.dimKey=this.tvm.dimensionList[e];b.val="X"===a||"*"===a?-1:parseInt(a,10);c.push(b)}return c},getSelectionInfoFromDimIndexAndValue:function(d,c){var e=[],b={};b.dimKey=this.tvm.dimensionList[d];b.val="X"===c||"*"===c?-1:parseInt(c,10);e.push(b);return e},predictNextState:function(d,c){var e=this.extendSelectionInfo(d,c);if(function(a){var b;f.each(a.selectionInfo(),function(a,c){b=-1===c.val});return b}(c)||this.tvm.exists(e.selectionInfo()))return e;
for(var b=this.extendSelectionInfo(d,c,-1),b=this.tvm.fetch(b.selectionInfo()),a=0,k=0,h,l=0;l<b.length;l++)k=this.getDimScore(b[l],e),k>a&&(h=l,a=k);return this.createNextDimSelection(b[h],e)}};return k});m.when("A","url-builder").register("twister-dimsum",function(e,l){function k(d,c,g,b){this.cache;b&&(this.cache=new b);this.ajaxTimeout=d;this.batchLimit=10;this.ajaxUrl="/gp/twister/dimension?asinList=###asinString###&vs=1"+(c||"");g&&(this.ajaxUrl+="&deviceType="+g);(d=e.state("pwState"))&&
d.isTryState&&(this.ajaxUrl=l.addUrlParams(this.ajaxUrl,{isTryState:"true"}))}var f=e.$;k.prototype={get:function(d,c,g){function b(c){var d=c-this.batchLimit,g="";0<d&&b.call(this,d);if(g=l.slice(0>d?0:d,c).join(","))c=this.ajaxUrl.replace("###asinString###",g),e.ajax(c,{chunk:a,timeout:this.ajaxTimeout})}function a(a){if(a)for(var b in a)if(a.hasOwnProperty(b)){var d=a[b];if(d&&d.asin){if(h){var e=k(d.asin,g);h.put(e,d)}c&&c(d)}}}function k(a,b){var c=a;e.objectIsEmpty(b)||(c={asin:a},f.extend(!0,
c,b));return c}var h=this.cache,l=[],m={};f.each(d,function(a,b){var d=k(b,g);h&&h.get(d)?c?c(h.get(d)):m[b]=h.get(d):l.push(b)});if(!c)return m;b.call(this,l.length)}};return k});m.when("A").register("twister-slots-dimsum",function(e){function l(c,d,b){this.cache=f;this.ajaxTimeout=c;this.batchLimit=8;this.ajaxUrl="/gp/twister/dimension?isDimensionSlotsAjax=1&asinList=###asinString###&vs=1"+(d||"");b&&(this.ajaxUrl+="&deviceType="+b)}var k=e.$,f={},d={};l.prototype={get:function(c,g){function b(c){var d=
c-this.batchLimit,g="",h=[];0<d&&b.call(this,d);h=l.slice(0>d?0:d,c);if(g=h.join(","))c=this.ajaxUrl.replace("###asinString###",g),e.ajax(c,{chunk:f,timeout:this.ajaxTimeout,cache:!0,error:a.apply(null,h)})}function a(){var a=arguments;return function(){e.each(a,function(a){delete d[a]})}}function f(a){if(a&&a.ASIN){var b=a.ASIN;h[b]=a;for(g&&g(a);d[b]&&d[b].length;)d[b].pop()(a);delete d[b]}}var h=this.cache,l=[],m={};k.each(c,function(a,b){h[b]?g?g(h[b]):m[b]=h[b]:d[b]&&g?d[b].push(g):g&&(l.push(b),
d[b]=[])});if(!g)return m;l.length&&b.call(this,l.length)}};return l});m.register("twister-metadata",function(){function e(){this.config={}}e.prototype={process:function(e,k,f){"METADATA"===e&&f(k)}};return e});m.when("A").register("publisherSubscriber",function(e){function l(){this.Subscribers=[];this.Names=[]}var k=e.$;l.prototype={register:function(f,d){if(-1<e.indexOfArray(this.Names,f))return!1;this.Names.push(f);this.Subscribers.push({name:f,handler:d})},deRegister:function(f){var d=
e.indexOfArray(this.Names,f),c=this,g=function(b,a){if(b.name===f)return c.Subscribers.splice(a,1),!0};return-1<d?(this.Names.splice(d,1),[].some?this.Subscribers.some(g):k.each(this.Subscribers,function(b,a){g(a,b)}),!0):!1},publish:function(){var e=arguments;k.each(this.Subscribers,function(d,c){setTimeout(function(){c.handler.apply(null,e)},0)})}};return l});m.when("jQuery").register("twister-state-machine",function(e){return function(e,k,f){function d(a,b){this.selected=function(){return a};
this.peek=function(){return b}}function c(a,b){return{THEN:function(c){a&&c&&c(b());return this},ELSE:function(c){a||c&&c(b());return this}}}var g,b;this.accept=function(a,e){var f;switch(a){case "VARIATION_PEEK":var l=k.createSelectionInfo(e);f=g();f.peek().matches(l)?f=!1:(-1===e.val?f=new d(g.selected(),g.selected()):(l=k.predictNextState(f.peek(),l),f=new d(f.selected(),l)),b=f,f=!0);f=c(f,this.currentState);break;case "VARIATION_CHANGE":f=g();var l=k.createSelectionInfo(e),m=k.getDimensionInfo();
f.selected().matches(l)?f=!1:(f=l.selectionInfo().length!==m.length?k.predictNextState(f.selected(),l):l,b=new d(f,f),f=!0);f=c(f,this.currentState);break;default:f=c(!1)}return f};g=this.currentState=function(){return b};(function(a){b=a})(new d(k.createSelectionInfo(f),k.createSelectionInfo(f)))}});m.when("A").register("twister-variation-matrix",function(e){function l(c){c=e.copy(c);var g=this;this.dimCombinations=c.dimCombinations;this.validCombinatonString=" "+e.keys(c.dimCombinations).join("  ")+
" ";this.dimensionInfo=c.dimensionInfo;this.dimensionList=c.dimensionList;this.dimensionDisplayText=c.dimensionDisplayText;this.config=c.config;this.dimInfoMap={};d.each(this.dimensionInfo,function(b,a){var c=a.dimKey,d={};d.size=a.size;d.dimOrder=b;g.dimInfoMap[c]=d});this.dimtoValueMap=c.dimtoValueMap}function k(c){c=d.map(c,function(c){c=c.val;return-1===c?"\\d+":""+c}).join(":");return new RegExp("\\s"+c+"\\s","gm")}function f(c){return d.map(c,function(c){return""+c.val}).join(":")}var d=e.$;
l.prototype={fetch:function(c){c=k(c);c=this.validCombinatonString.match(c);return c=d.map(c,function(c){return d.trim(c)})},exists:function(c){return f(c)in this.dimCombinations}};return l});m.when("A","jQuery").register("url-builder",function(e,l){function k(c,d){var b;if(c&&d&&"object"==typeof d){b=c;var a="?";e.each(d,function(c,e){c=d[e];b+=a+e+"="+c;a="&"})}return b}function f(c){var d;c&&(d=c.split("?")[0]);return d}function d(c){var d={};c&&(c=c.split("?"),1<c.length&&(c=c[1].split("&"),
e.each(c,function(b,a){var c=b.split("=");d[c[0]]=c[1]})));return d}return{addUrlParams:function(c,e){var b=c;if(c&&e&&"object"==typeof e)var b=f(c),a=d(c),a=l.extend(a,e),b=k(b,a);return b},removeUrlParams:function(c,g){var b=c;if(c&&g&&"object"==typeof g){var b=f(c),a=d(c);e.each(g,function(b,c){delete a[b]});b=k(b,a)}return b}}})})})(function(){var m=window.AmazonUIPageJS||window.P,p=m._namespace||m.attributeErrors;return p?p("TwisterCoreAsset"):m}(),window);