(function(m,p,x){m.execute(function(){m.when("A","dp-refresh-handler","view-util","twister-string-constants").register("page-refresh-view",function(e,l,k,f){var d=e.$;return function(c,g,b){function a(a){return{chunk:function(a){var b=a.ASIN,h=a.Value;a=a.FeatureName;if(!v.hiddenFeatures[a]){var c,n;try{a&&h&&h.content&&(n=h.content[a],"undefined"!==typeof n&&(c=d("#"+a),c.html(n),c.css({opacity:""})))}catch(g){a=a||"NoFeatureName",F.logFatal(g,{message:"Error in feature"+a})}v.twisterRefreshHandler.stampFeature(a,
b)}},success:function(a,h,b){N("twisterUpdateSuccess")},error:function(a,h,b){Twister.$("#variations-overlay").hide();N("twisterUpdateFailure");Twister.showErrorMessageOnFailure&&(alert(Twister.errorMessageOnFailure),location.reload())},abort:function(a){F.logFatal("Ajax aborted: "+a)},timeout:4E4}}function n(a,h,b,c,d){var n={},g=[];"parent"===a?(n=C(h,c,"parent",d),g.parent=n,n=C(b,c,"partial",d),g.partial=n):(n=C(b,c,a,d),g[a]=n);return g}function h(a,b,h,c,n){for(var g in a)if(a.hasOwnProperty(g)){if("full"===
g){var e=h.dimensionType,r=v.twisterUtil.getDimensionInfo().length;v.twisterRefreshHandler.startMeasurement(h.newAsin,e,r,h.dimensionDisplayType)}e=a[g].twisterRefreshParams;r=a[g].notifyClientParams;n&&(d(v.config[g].affectedFeatures).css({opacity:.5}),v.twisterRefreshHandler.doPageRefresh(null,e,b,c));w(r.asin,r.id,g,n)}}function r(){d.each(g.contextMetaData,function(a,h){var b={},c=h.elementList||[],n=c.length,g=[];b.click={};b.mouseOver={};for(var e=0;e<n;e++){var r=d("#"+c[e].divToUpdate);g.push("#"+
c[e].divToUpdate);r.length&&c[e].customClientFunction&&(c[e].updateOnHover&&(b.mouseOver[c[e].divToUpdate]=r.attr("customfunctionname")),b.click[c[e].divToUpdate]=r.attr("customfunctionname"))}v.config[a].affectedFeatures=g.join(",");v.config[a].clientFeatures=b})}function w(a,b,h,c){var n="",n=c?f.EVENT_TYPE_CLICK:f.EVENT_TYPE_MOUSEOVER;d.each(v.config[h].clientFeatures[n],function(h,c){try{var d=function(){v.twisterRefreshHandler.stampImageLoad(a)};(function(){var a={};a.P=m;(function(){eval("var P = this.P;");
var a=x,a=eval("0, "+c);a(b,DetailPage.StateController,d)}).call(a)})()}catch(n){F.logFatal("Client feature - "+h+", threw and exception :- "+n)}})}function C(a,b,h,c){var d={},n={};d.asinList=a;d.id="parent"===h?a:"partial"===c?b:a;d.mType=h;d=t(h,d);h=!1;(c=e.state("pwState"))&&(h=c.isTryState);h&&(d.isTryState=h);d=v.twisterRefreshHandler.createCustomParamsMap({},d);n.asin=a;n.id=b;return{twisterRefreshParams:d,notifyClientParams:n}}function t(a,h){d.each(g.contextMetaData[a].mTypeSpecificURLParams,
function(a,b){h[a]=b});return h}function y(a){a=v.twisterUtil.getSelectionInfoFromSelectedVariationValuesMap(a.selected_variation_values);v.twisterUtil.isFullySelected(a)?v.currentPageSelectionState="full":v.currentPageSelectionState="partial"}function z(a){var h={};a=a.twisterUpdateURLInfo.immutableURLPrefix;a+="&isFlushing=2&dpEnvironment="+Twister.dpEnvironment;h.pageRefreshUrl=a;return h}function u(a){var h={};h.config=a.measurement;h.dimensionDisplayType=a.dimensionsDisplayType;h.storeID=a.storeID;
h.productGroupID=a.productGroupID;return h}function A(a,h){var b;"partial"===a&&"partial"===h&&(b="partial");"partial"===a&&"full"===h&&(b="full");"full"===a&&"partial"===h&&(b="parent");"full"===a&&"full"===h&&(b="full");return b}var v=this,q=p.ue,D="",F=new b("dpTwisterPageRefreshView");this.twisterUtil=c.util;this.twisterFeatureName="Twister";this.currentPageSelectionState;this.twisterRefreshHandler;this.config={partial:{},full:{},parent:{},master:{}};this.hiddenFeatures={intermediateEOS:1,EOS:1};
v.viewUtil=new k(c);v.subType;var N=function(a){q&&q.count&&q.count(a,(q.count(a)||0)+1)};(function(){y(g);r();var b={featureName:v.twisterFeatureName},d=z(g),e=u(g);v.twisterRefreshHandler=new l(b,d,e);c.registerPassive({viewAttribution:"DetailPage",viewName:"WebTwisterRefreshView"},{updateView:function(b,c){var d={};if(b!==f.METADATA){var d={},e=x;if(c)switch(b){case f.VARIATION_CHANGE:e=c.selected().selInfo;break;case f.VARIATION_PEEK:e=c.peek().selInfo}d.selectionInfo=e;d.childAsin=v.twisterUtil.getAsinFromSelectionInfo(d.selectionInfo);
d.newAsin=d.childAsin;d.dimensionCombination=v.viewUtil.getCurrDimCombId(d.selectionInfo,"_","X");d.newPageSelectionState=v.twisterUtil.isFullySelected(d.dimensionCombination)?"full":"partial";d.mTypeForRefresh=A(v.currentPageSelectionState,d.newPageSelectionState);d.doNotAbort="parent"===d.mTypeForRefresh?!0:!1;d.twisterCallListParams=n(d.mTypeForRefresh,d.newAsin,d.childAsin,d.dimensionCombination,d.newPageSelectionState);d.optionsForTwisterRefresh=a(c);d.pageRefreshMeasure={newAsin:d.newAsin,dimensionType:D,
dimensionDisplayType:g.dimensionsDisplayType}}switch(b){case f.VARIATION_CHANGE:v.subType!==f.PRODUCTIZED_VIEW_SUBTYPE&&(h(d.twisterCallListParams,d.optionsForTwisterRefresh,d.pageRefreshMeasure,d.doNotAbort,!0),v.currentPageSelectionState=d.newPageSelectionState,v.subType=x);break;case f.VARIATION_PEEK:h(d.twisterCallListParams,d.optionsForTwisterRefresh,d.pageRefreshMeasure,d.doNotAbort,!1);v.currentPageSelectionState=d.newPageSelectionState;break;case f.METADATA:switch(c.subType){case f.DP_STATE_VIEW_SUBTYPE:D=
c.divMetadata.dimDisplayType;break;case f.PRODUCTIZED_VIEW_SUBTYPE:v.subType=c.subType,d.dimensionCombination=c.newDimCombID,d.childAsin=c.childAsin,d.newAsin=c.newAsin,d.newPageSelectionState=v.twisterUtil.isFullySelected(d.dimensionCombination)?"full":"partial",d.mTypeForRefresh=A(v.currentPageSelectionState,d.newPageSelectionState),d.doNotAbort="parent"===d.mTypeForRefresh?!0:!1,d.twisterCallListParams=n(d.mTypeForRefresh,d.newAsin,d.childAsin,d.dimensionCombination,d.newPageSelectionState),d.optionsForTwisterRefresh=
a(c),d.pageRefreshMeasure={newAsin:d.newAsin,dimensionType:c.divMetaData?c.divMetaData.dimDisplayType:x,dimensionDisplayType:g.dimensionsDisplayType},h(d.twisterCallListParams,d.optionsForTwisterRefresh,d.pageRefreshMeasure,d.doNotAbort,!0),v.currentPageSelectionState=d.newPageSelectionState}}}})})()}})})})(function(){var m=window.AmazonUIPageJS||window.P,p=m._namespace||m.attributeErrors;return p?p("DetailPageTwisterViewAsset"):m}(),window);