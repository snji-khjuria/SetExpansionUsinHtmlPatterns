var Snapdeal=Snapdeal||{};Snapdeal.chat=(function(){var J,H,G;J=pageName;function C(){$zopim(function(){$zopim.livechat.window.onHide(function(){A()});$zopim.livechat.window.onShow(function(){I()});$zopim.livechat.setOnChatStart(function(){E();Snapdeal.Cookie.set("pdpChat","load")});$zopim.livechat.setOnChatEnd(function(){M();Snapdeal.Cookie.set("pdpChat","",-1)})})}function I(){if(J==="ProductDetailPage"){Snapdeal.omni.fire("onChatBoxExpand",G);SDLogger.log("clickStream","onChatBoxExpand",G)}else{Snapdeal.omni.fire("onChatBoxExpand",H);SDLogger.log("clickStream","onChatBoxExpand",H)}}function A(){if(J==="ProductDetailPage"){Snapdeal.omni.fire("onChatBoxMinimize",G);SDLogger.log("clickStream","onChatBoxMinimize",G)}else{Snapdeal.omni.fire("onChatBoxMinimize",H);SDLogger.log("clickStream","onChatBoxMinimize",H)}}function E(){if(J==="ProductDetailPage"){Snapdeal.omni.fire("onConversationStart",G);SDLogger.log("clickStream","onConversationStart",G)}else{Snapdeal.omni.fire("onConversationStart",H);SDLogger.log("clickStream","onConversationStart",H)}var O=JSON.parse(Snapdeal.localStorage.getItem("authData"));if(O&&O.firstName){var N;if(O.lastName){N=O.firstName+O.lastName}else{N=O.firstName}$zopim(function(){$zopim.livechat.setName(N);$zopim.livechat.setEmail(O.trackingEmail);$zopim.livechat.setPhone(O.mobile)})}}function M(){if(J==="ProductDetailPage"){Snapdeal.omni.fire("onConversationEnd",G);SDLogger.log("render","onConversationEnd",G)}else{Snapdeal.omni.fire("onConversationEnd",H);SDLogger.log("render","onConversationEnd",H)}}function L(N){var O;O=(!!J&&J=="checkout")?true:false;chatScript();$zopim(function(){if($zopim.livechat.isChatting()){Snapdeal.Cookie.set("pdpChat","load")}else{Snapdeal.Cookie.set("pdpChat","",-1)}});if(O){$zopim(function(){$zopim.livechat.window.hide()})}if(!!N){$zopim(function(){$zopim.livechat.departments.setVisitorDepartment(N)})}if(J==="ProductDetailPage"){Snapdeal.omni.fire("onChatBoxShow",G);SDLogger.log("render","onChatBoxShow",G)}else{Snapdeal.omni.fire("onChatBoxShow",H);SDLogger.log("render","onChatBoxShow",H)}}function F(){if(K()){var O=Snapdeal.getAjaxResourcesPath("/web/getpageexperiments");var P="plpView";if(J=="searchResult"){P="searchResultsView"}else{if(J=="searchCategory"){P="searchCategoryView"}}var N={cookie:Snapdeal.Cookie.get("u"),appType:"WEB",event:P};$.ajax({url:O,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(N),success:function(U){if(!!U&&!!U.actions&&U.actions.length>0){var Q=U.actions.length;for(var R=0;R<Q;R++){action=U.actions[R];if(action.templateStyle=="chat_integration"){var W=true,S,T;try{S=JSON.parse(action.data).group;T=JSON.parse(action.data).scroll}catch(V){S=action.data}D(W,S,T)}}}else{D(false)}},error:function(){D(false)},complete:function(){}})}}function D(Q,O,P){Snapdeal.chat.showOnPage=P;if($("#chatFlag").length>0){$("#chatFlag").val(Q)}else{var R='<input type="hidden" value="'+Q+'" id="chatFlag" />';$("body").append(R)}if(!!O){if($("#chatDepartment").length>0){$("#chatDepartment").val(O)}else{var N='<input type="hidden" value="'+O+'" id="chatDepartment" />';$("body").append(N)}}}function K(){if(J==="searchResult"||J==="searchCategory"||J==="categoryPage"){return true}return false}function B(){var N=$(".zopim");if(!!N&&N.length>0){return true}return false}return{init:function(){var P=Snapdeal.Cookie.get("pdpChat"),O,N=!!document.getElementById("chatDepartment")?document.getElementById("chatDepartment").value:"";J=J||$("body").data("pagename")||location.pathname.split("/").pop();H={pageName:J};G={pageName:J,pdpChatCatalogId:$("#catalogId").val()};if(J==="ProductDetailPage"||J==="HomePage"||K()){O=$("#chatFlag").val()}else{O="false"}if(P||(O=="true")){L(N)}},listen:function(){C()},getCXEData:function(){return F.apply(this,arguments)},isChatShown:function(){return B.apply(this,arguments)},isListingPage:function(){return K.apply(this,arguments)}}})();window.setTimeout(function(){if(!!Snapdeal.Cookie.get("pdpChat")){Snapdeal.chat.init()}if(!Snapdeal.Cookie.get("pdpChat")&&!Snapdeal.chat.isChatShown()&&Snapdeal.chat.isListingPage()){Snapdeal.chat.getCXEData()}},1000);
